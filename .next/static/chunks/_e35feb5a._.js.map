{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/CMPRO128GB/AGI_projects/maiChuong_github/cmpro-gaomotion/components/MotionSelector.tsx"],"sourcesContent":["import React from 'react';\n\n/**\n * Defines the types of motion capture available.\n * - 'pose': Captures body pose only.\n * - 'face': Captures facial landmarks only.\n * - 'hands': Captures hand landmarks only.\n * - 'holistic': Captures all landmarks (pose, face, and hands).\n */\nexport type CaptureType = 'pose' | 'face' | 'hands' | 'holistic';\n\n/**\n * Props for the MotionSelector component.\n */\ninterface MotionSelectorProps {\n  /**\n   * A callback function that is invoked when a capture type is selected.\n   * @param type The selected capture type.\n   */\n  onSelect: (type: CaptureType) => void;\n}\n\nconst captureOptions: { type: CaptureType; title: string; description: string }[] = [\n  {\n    type: 'holistic',\n    title: 'Holistic Capture',\n    description: 'Capture full body, face, and hand motion simultaneously.',\n  },\n  {\n    type: 'pose',\n    title: 'Pose Capture',\n    description: 'Capture body pose landmarks only.',\n  },\n  {\n    type: 'face',\n    title: 'Face Capture',\n    description: 'Capture facial expression landmarks.',\n  },\n  {\n    type: 'hands',\n    title: 'Hands Capture',\n    description: 'Capture individual hand and finger tracking.',\n  },\n];\n\n/**\n * A component that presents the user with different motion capture options\n * and allows them to select one to begin the capture process.\n */\nconst MotionSelector: React.FC<MotionSelectorProps> = ({ onSelect }) => {\n  return (\n    <div className=\"w-full max-w-2xl text-center\">\n      <h1 className=\"text-4xl font-bold mb-2\">Motion Capture</h1>\n      <p className=\"text-lg text-neutral-600 dark:text-neutral-400 mb-8\">Select a capture type to begin.</p>\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        {captureOptions.map((option) => (<button key={option.type} onClick={() => onSelect(option.type)} className=\"p-6 border border-neutral-200 dark:border-neutral-800 rounded-lg text-left hover:bg-neutral-100 dark:hover:bg-neutral-800/30 transition-all duration-200 ease-in-out transform hover:scale-105\">\n            <h2 className=\"text-xl font-semibold mb-2\">{option.title}</h2>\n            <p className=\"text-neutral-500 dark:text-neutral-400\">{option.description}</p>\n          </button>))}\n      </div>\n    </div>);\n};\n\nexport default MotionSelector;\n\n"],"names":[],"mappings":";;;;;AAsBA,MAAM,iBAA8E;IAClF;QACE,MAAM;QACN,OAAO;QACP,aAAa;IACf;IACA;QACE,MAAM;QACN,OAAO;QACP,aAAa;IACf;IACA;QACE,MAAM;QACN,OAAO;QACP,aAAa;IACf;IACA;QACE,MAAM;QACN,OAAO;QACP,aAAa;IACf;CACD;AAED;;;CAGC,GACD,MAAM,iBAAgD;QAAC,EAAE,QAAQ,EAAE;IACjE,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAG,WAAU;0BAA0B;;;;;;0BACxC,6LAAC;gBAAE,WAAU;0BAAsD;;;;;;0BACnE,6LAAC;gBAAI,WAAU;0BACZ,eAAe,GAAG,CAAC,CAAC,uBAAY,6LAAC;wBAAyB,SAAS,IAAM,SAAS,OAAO,IAAI;wBAAG,WAAU;;0CACvG,6LAAC;gCAAG,WAAU;0CAA8B,OAAO,KAAK;;;;;;0CACxD,6LAAC;gCAAE,WAAU;0CAA0C,OAAO,WAAW;;;;;;;uBAF/B,OAAO,IAAI;;;;;;;;;;;;;;;;AAMjE;KAZM;uCAcS","debugId":null}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/CMPRO128GB/AGI_projects/maiChuong_github/cmpro-gaomotion/components/TunnelPairer.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from 'react';\n\n// Define the possible connection statuses for the tunnel\nexport type TunnelStatus = 'disconnected' | 'connecting' | 'connected' | 'error';\n\ninterface TunnelPairerProps {\n  status: TunnelStatus;\n  error?: string | null;\n  onConnect: (url: string) => void;\n  onDisconnect: () => void;\n}\n\nconst TunnelPairer: React.FC<TunnelPairerProps> = ({\n  status,\n  error,\n  onConnect,\n  onDisconnect,\n}) => {\n  const [url, setUrl] = useState('');\n\n  const isConnected = status === 'connected';\n  const isConnecting = status === 'connecting';\n\n  const handleConnect = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (url.trim()) {\n      onConnect(url.trim());\n    }\n  };\n\n  return (\n    <div className=\"p-6 border rounded-lg w-full max-w-md shadow-md bg-white dark:bg-neutral-900\">\n      <h2 className=\"text-xl font-semibold mb-4\">Blender Tunnel Connection</h2>\n\n      {isConnected ? (\n        <div className=\"text-center\">\n          <p className=\"text-green-500 mb-4 font-medium\">Status: Connected</p>\n          <button\n            onClick={onDisconnect}\n            className=\"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors\"\n          >\n            Disconnect\n          </button>\n        </div>\n      ) : (\n        <form onSubmit={handleConnect} className=\"space-y-4\">\n          <div>\n            <label htmlFor=\"tunnel-url\" className=\"block text-sm font-medium mb-1\">\n              Paste Tunnel URL\n            </label>\n            <input\n              id=\"tunnel-url\"\n              type=\"text\"\n              value={url}\n              onChange={(e) => setUrl(e.target.value)}\n              placeholder=\"wss://your-tunnel-url.io\"\n              disabled={isConnecting}\n              className=\"w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:ring-ring focus:ring-2 focus:outline-none\"\n            />\n          </div>\n          <button\n            type=\"submit\"\n            disabled={isConnecting || !url.trim()}\n            className=\"w-full px-4 py-2 bg-blue-600 text-white rounded-lg disabled:bg-gray-400 transition-colors\"\n          >\n            {isConnecting ? 'Connecting...' : 'Connect'}\n          </button>\n          {error && <p className=\"text-red-500 text-sm mt-2\">{error}</p>}\n        </form>\n      )}\n    </div>\n  );\n};\n\nexport default TunnelPairer;"],"names":[],"mappings":";;;;AAEA;;;AAFA;;AAcA,MAAM,eAA4C;QAAC,EACjD,MAAM,EACN,KAAK,EACL,SAAS,EACT,YAAY,EACb;;IACC,MAAM,CAAC,KAAK,OAAO,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAE/B,MAAM,cAAc,WAAW;IAC/B,MAAM,eAAe,WAAW;IAEhC,MAAM,gBAAgB,CAAC;QACrB,EAAE,cAAc;QAChB,IAAI,IAAI,IAAI,IAAI;YACd,UAAU,IAAI,IAAI;QACpB;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAG,WAAU;0BAA6B;;;;;;YAE1C,4BACC,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAE,WAAU;kCAAkC;;;;;;kCAC/C,6LAAC;wBACC,SAAS;wBACT,WAAU;kCACX;;;;;;;;;;;yEAKH,6LAAC;gBAAK,UAAU;gBAAe,WAAU;;kCACvC,6LAAC;;0CACC,6LAAC;gCAAM,SAAQ;gCAAa,WAAU;0CAAiC;;;;;;0CAGvE,6LAAC;gCACC,IAAG;gCACH,MAAK;gCACL,OAAO;gCACP,UAAU,CAAC,IAAM,OAAO,EAAE,MAAM,CAAC,KAAK;gCACtC,aAAY;gCACZ,UAAU;gCACV,WAAU;;;;;;;;;;;;kCAGd,6LAAC;wBACC,MAAK;wBACL,UAAU,gBAAgB,CAAC,IAAI,IAAI;wBACnC,WAAU;kCAET,eAAe,kBAAkB;;;;;;oBAEnC,uBAAS,6LAAC;wBAAE,WAAU;kCAA6B;;;;;;;;;;;;;;;;;;AAK9D;GA5DM;KAAA;uCA8DS","debugId":null}},
    {"offset": {"line": 247, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/CMPRO128GB/AGI_projects/maiChuong_github/cmpro-gaomotion/hooks/useMotionCapture.ts"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useCallback, useEffect } from 'react';\nimport {\n  MotionLandmarker,\n  FilesetResolver,\n  MotionLandmarkerResult,\n  PoseLandmarker,\n  FaceLandmarker,\n  HandLandmarker,\n  DrawingUtils,\n} from '@mediapipe/tasks-vision';\nimport { CaptureType } from '@/components/MotionSelector';\n// import { InputSourceType } from '@/components/InputSelector';\n\n/**\n * Re-exporting MotionLandmarkerResult as MotionData for consistency in the app.\n */\nexport type MotionData = MotionLandmarkerResult;\n\n/**\n * Props for the useMotionCapture hook.\n */\ninterface useMotionCaptureProps {\n  inputSource: InputSourceType;\n  videoUrl?: string;\n  captureType: CaptureType;\n  onData: (data: MotionData) => void;\n}\n\n/**\n * A custom hook to manage MediaPipe motion capture from a webcam or video file.\n * It handles the initialization of the MotionLandmarker, manages the video stream,\n * runs the detection loop, and draws the results onto a canvas.\n */\nexport const useMotionCapture = ({\n  inputSource,\n  videoUrl,\n  captureType,\n  onData,\n}: useMotionCaptureProps) => {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const motionLandmarkerRef = useRef<MotionLandmarker | null>(null);\n  const lastVideoTimeRef = useRef(-1);\n  const animationFrameIdRef = useRef<number | null>(null);\n\n  const [isCameraOn, setIsCameraOn] = useState(false);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  /**\n   * Creates and initializes the MotionLandmarker instance.\n   * This is an asynchronous operation that needs to fetch the model files.\n   */\n  const createMotionLandmarker = useCallback(async () => {\n    try {\n      const vision = await FilesetResolver.forVisionTasks(\n        'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm'\n      );\n      const landmarker = await MotionLandmarker.createFromOptions(vision, {\n        baseOptions: {\n          modelAssetPath: `https://storage.googleapis.com/mediapipe-models/motion_landmarker/motion_landmarker/float16/1/motion_landmarker.task`,\n          delegate: 'GPU',\n        },\n        runningMode: 'VIDEO',\n        numPoses: 1,\n        minPoseDetectionConfidence: 0.5,\n        minPosePresenceConfidence: 0.5,\n        minTrackingConfidence: 0.5,\n      });\n      motionLandmarkerRef.current = landmarker;\n      setError(null);\n    } catch (e) {\n      console.error('Failed to create MotionLandmarker:', e);\n      setError('Failed to initialize motion capture model. Please try again.');\n    }\n  }, []);\n\n  // Initialize the landmarker when the component mounts.\n  useEffect(() => {\n    if (!motionLandmarkerRef.current) {\n      createMotionLandmarker();\n    }\n  }, [createMotionLandmarker]);\n\n  const stopCapture = useCallback(() => {\n    if (animationFrameIdRef.current) {\n      cancelAnimationFrame(animationFrameIdRef.current);\n      animationFrameIdRef.current = null;\n    }\n    if (videoRef.current && videoRef.current.srcObject) {\n      const stream = videoRef.current.srcObject as MediaStream;\n      stream.getTracks().forEach((track) => track.stop());\n      videoRef.current.srcObject = null;\n    }\n    setIsCameraOn(false);\n    setIsProcessing(false);\n  }, []);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      stopCapture();\n      motionLandmarkerRef.current?.close();\n    };\n  }, [stopCapture]);\n\n  const predict = useCallback(() => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const landmarker = motionLandmarkerRef.current;\n\n    if (!video || !canvas || !landmarker || video.paused || video.ended) {\n      return;\n    }\n\n    const currentTime = video.currentTime;\n    if (currentTime > lastVideoTimeRef.current) {\n      lastVideoTimeRef.current = currentTime;\n      const results = landmarker.detectForVideo(video, Date.now());\n\n      const canvasCtx = canvas.getContext('2d');\n      if (canvasCtx && results) {\n        const drawingUtils = new DrawingUtils(canvasCtx);\n        canvas.width = video.videoWidth;\n        canvas.height = video.videoHeight;\n        canvasCtx.clearRect(0, 0, canvas.width, canvas.height);\n\n        // Draw landmarks based on capture type\n        if (captureType === 'pose' || captureType === 'holistic') {\n          results.poseLandmarks.forEach((landmarks) => {\n            drawingUtils.drawConnectors(landmarks, PoseLandmarker.POSE_CONNECTIONS, { color: '#00FF00', lineWidth: 4 });\n            drawingUtils.drawLandmarks(landmarks, { color: '#FF0000', radius: 5 });\n          });\n        }\n        if (captureType === 'face' || captureType === 'holistic') {\n          results.faceLandmarks.forEach((landmarks) => {\n            drawingUtils.drawConnectors(landmarks, FaceLandmarker.FACE_LANDMARKS_TESSELATION, { color: '#C0C0C070', lineWidth: 1 });\n          });\n        }\n        if (captureType === 'hands' || captureType === 'holistic') {\n          results.handLandmarks.forEach((landmarks) => {\n            drawingUtils.drawConnectors(landmarks, HandLandmarker.HAND_CONNECTIONS, { color: '#00CCFF', lineWidth: 5 });\n            drawingUtils.drawLandmarks(landmarks, { color: '#FF0000', radius: 5 });\n          });\n        }\n        onData(results);\n      }\n    }\n\n    animationFrameIdRef.current = requestAnimationFrame(predict);\n  }, [captureType, onData]);\n\n  const startCapture = useCallback(async () => {\n    if (!motionLandmarkerRef.current) {\n      setError('Motion capture is not ready. Please wait.');\n      return;\n    }\n    if (isCameraOn) return;\n\n    stopCapture(); // Ensure previous streams are stopped\n    setIsProcessing(true);\n    setError(null);\n\n    try {\n      const video = videoRef.current;\n      if (!video) return;\n\n      if (inputSource === 'webcam') {\n        const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480 }, audio: false });\n        video.srcObject = stream;\n      } else if (inputSource === 'video' && videoUrl) {\n        video.src = videoUrl;\n        video.loop = true;\n      } else {\n        throw new Error('Invalid input source or missing video URL.');\n      }\n\n      video.onloadedmetadata = () => {\n        video.play();\n        setIsCameraOn(true);\n        setIsProcessing(false);\n        lastVideoTimeRef.current = -1;\n        predict();\n      };\n    } catch (err) {\n      console.error('Failed to start capture:', err);\n      setError('Failed to access camera or video. Please check permissions and try again.');\n      setIsProcessing(false);\n    }\n  }, [isCameraOn, stopCapture, inputSource, videoUrl, predict]);\n\n  return { videoRef, canvasRef, isCameraOn, isProcessing, error, startCapture, stopCapture };\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 470, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/CMPRO128GB/AGI_projects/maiChuong_github/cmpro-gaomotion/lib/json-export.ts"],"sourcesContent":["import { MotionData } from '@/hooks/useMotionCapture';\nimport { CaptureType } from '@/components/MotionSelector';\n\n// Define a structured format for the exported data, including schema versioning.\nexport interface MotionDataPacket {\n  schemaVersion: string;\n  captureType: CaptureType;\n  timestamp: string;\n  data: MotionData;\n}\n\nconst SCHEMA_VERSION = '1.0.0';\n\n/**\n * Creates a structured data packet for export or transmission.\n */\nexport const createMotionDataPacket = (\n  motionData: MotionData,\n  captureType: CaptureType\n): MotionDataPacket => ({\n  schemaVersion: SCHEMA_VERSION,\n  captureType: captureType,\n  timestamp: new Date().toISOString(),\n  data: motionData,\n});\n\n/**\n * Saves the captured motion data to a JSON file and triggers a browser download.\n *\n * @param motionData The raw motion data from MediaPipe.\n * @param captureType The type of capture that was performed.\n */\nexport const downloadMotionDataAsJson = (\n  motionData: MotionData,\n  captureType: CaptureType\n): void => {\n  const exportObject = createMotionDataPacket(motionData, captureType);\n  const jsonString = JSON.stringify(exportObject, null, 2);\n  const blob = new Blob([jsonString], { type: 'application/json' });\n  const url = URL.createObjectURL(blob);\n\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = `gaomotion_${captureType}_${new Date().getTime()}.json`;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n};\n\n/**\n * Saves the captured motion data to the browser's localStorage.\n */\nexport const saveMotionDataToLocalStorage = (\n  motionData: MotionData,\n  captureType: CaptureType,\n  key: string = 'latestMotionData'\n): void => {\n  try {\n    const exportObject = createMotionDataPacket(motionData, captureType);\n    const jsonString = JSON.stringify(exportObject);\n    localStorage.setItem(key, jsonString);\n  } catch (error) {\n    console.error('Failed to save motion data to localStorage:', error);\n  }\n};"],"names":[],"mappings":";;;;;AAWA,MAAM,iBAAiB;AAKhB,MAAM,yBAAyB,CACpC,YACA,cACqB,CAAC;QACtB,eAAe;QACf,aAAa;QACb,WAAW,IAAI,OAAO,WAAW;QACjC,MAAM;IACR,CAAC;AAQM,MAAM,2BAA2B,CACtC,YACA;IAEA,MAAM,eAAe,uBAAuB,YAAY;IACxD,MAAM,aAAa,KAAK,SAAS,CAAC,cAAc,MAAM;IACtD,MAAM,OAAO,IAAI,KAAK;QAAC;KAAW,EAAE;QAAE,MAAM;IAAmB;IAC/D,MAAM,MAAM,IAAI,eAAe,CAAC;IAEhC,MAAM,IAAI,SAAS,aAAa,CAAC;IACjC,EAAE,IAAI,GAAG;IACT,EAAE,QAAQ,GAAG,AAAC,aAA2B,OAAf,aAAY,KAAwB,OAArB,IAAI,OAAO,OAAO,IAAG;IAC9D,SAAS,IAAI,CAAC,WAAW,CAAC;IAC1B,EAAE,KAAK;IACP,SAAS,IAAI,CAAC,WAAW,CAAC;IAC1B,IAAI,eAAe,CAAC;AACtB;AAKO,MAAM,+BAA+B,SAC1C,YACA;QACA,uEAAc;IAEd,IAAI;QACF,MAAM,eAAe,uBAAuB,YAAY;QACxD,MAAM,aAAa,KAAK,SAAS,CAAC;QAClC,aAAa,OAAO,CAAC,KAAK;IAC5B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+CAA+C;IAC/D;AACF","debugId":null}},
    {"offset": {"line": 518, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/CMPRO128GB/AGI_projects/maiChuong_github/cmpro-gaomotion/components/RigMapper.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { RigPose } from '@/types/rig';\n\n/**\n * A component to visualize the live rig pose data being generated.\n */\nconst RigMapper: React.FC<{ pose: RigPose | null }> = ({ pose }) => {\n  return (\n    <div className=\"p-6 border rounded-lg w-full max-w-md shadow-md bg-white dark:bg-neutral-900\">\n      <h2 className=\"text-xl font-semibold mb-4\">Rig Mapper (Live Data)</h2>\n      <div className=\"space-y-2 text-sm text-neutral-600 dark:text-neutral-400\">\n        {pose ? (\n          <pre className=\"text-xs bg-neutral-100 dark:bg-neutral-800 p-2 rounded-md overflow-x-auto max-h-64\">\n            <code>{JSON.stringify(pose, null, 2)}</code>\n          </pre>\n        ) : (\n          <div className=\"text-center py-10\">\n            <p>Waiting for motion data...</p>\n            <p className=\"text-xs text-neutral-500 mt-2\">\n              Start the camera to see live pose data here.\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default RigMapper;"],"names":[],"mappings":";;;;AAAA;;AAKA;;CAEC,GACD,MAAM,YAAgD;QAAC,EAAE,IAAI,EAAE;IAC7D,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAG,WAAU;0BAA6B;;;;;;0BAC3C,6LAAC;gBAAI,WAAU;0BACZ,qBACC,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;kCAAM,KAAK,SAAS,CAAC,MAAM,MAAM;;;;;;;;;;6EAGpC,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;sCAAE;;;;;;sCACH,6LAAC;4BAAE,WAAU;sCAAgC;;;;;;;;;;;;;;;;;;;;;;;AAQzD;KApBM;uCAsBS","debugId":null}},
    {"offset": {"line": 603, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/CMPRO128GB/AGI_projects/maiChuong_github/cmpro-gaomotion/services/motion/mapper.ts"],"sourcesContent":["import { MotionData } from '@/hooks/useMotionCapture';\nimport { RigPose } from '@/types/rig';\nimport { Quaternion, Vector3, Matrix4 } from 'three';\n\n// MediaPipe Pose Landmark indices for easy access\nconst POSE_LANDMARKS = {\n  LEFT_SHOULDER: 11,\n  RIGHT_SHOULDER: 12,\n  LEFT_ELBOW: 13,\n  RIGHT_ELBOW: 14,\n  LEFT_WRIST: 15,\n  RIGHT_WRIST: 16,\n  LEFT_HIP: 23,\n  RIGHT_HIP: 24,\n};\n\n/**\n * Maps raw MediaPipe landmark data to a standardized rig pose.\n *\n * This is where the core mapping logic will reside. It will involve:\n * 1. Defining a mapping between MediaPipe landmarks and rig bones.\n * 2. Using vector math to calculate bone rotations from landmark positions.\n * 3. Comparing these rotations against a base \"T-pose\" to get the final rotation value.\n *\n * @param motionData The raw output from a MediaPipe Landmarker.\n * @returns A `RigPose` object representing the character's current pose.\n */\nexport const mapMotionDataToRigPose = (motionData: MotionData): RigPose | null => {\n  // TODO: Implement the mapping logic.\n  // For now, we'll just check if data exists.\n  if (!motionData?.landmarks || motionData.landmarks.length === 0) {\n    return null;\n  }\n\n  const rigPose: RigPose = {};\n\n  // --- PSEUDOCODE for mapping logic ---\n  // const worldLandmarks = motionData.worldLandmarks[0];\n  // if (worldLandmarks) {\n  //   const leftShoulder = worldLandmarks[11];\n  //   const leftElbow = worldLandmarks[13];\n  //   const leftWrist = worldLandmarks[15];\n  //   // const forearmRotation = calculateRotation(leftShoulder, leftElbow, leftWrist);\n  //   // rigPose['forearm.L'] = { rotation: forearmRotation };\n  // }\n  // --- END PSEUDOCODE ---\n\n  // For now, we'll return the raw data inside the 'data' property for debugging.\n  // This should be replaced with the actual RigPose object.\n  return { data: motionData };\n};"],"names":[],"mappings":";;;AAIA,kDAAkD;AAClD,MAAM,iBAAiB;IACrB,eAAe;IACf,gBAAgB;IAChB,YAAY;IACZ,aAAa;IACb,YAAY;IACZ,aAAa;IACb,UAAU;IACV,WAAW;AACb;AAaO,MAAM,yBAAyB,CAAC;IACrC,qCAAqC;IACrC,4CAA4C;IAC5C,IAAI,EAAC,uBAAA,iCAAA,WAAY,SAAS,KAAI,WAAW,SAAS,CAAC,MAAM,KAAK,GAAG;QAC/D,OAAO;IACT;IAEA,MAAM,UAAmB,CAAC;IAE1B,uCAAuC;IACvC,uDAAuD;IACvD,wBAAwB;IACxB,6CAA6C;IAC7C,0CAA0C;IAC1C,0CAA0C;IAC1C,sFAAsF;IACtF,6DAA6D;IAC7D,IAAI;IACJ,yBAAyB;IAEzB,+EAA+E;IAC/E,0DAA0D;IAC1D,OAAO;QAAE,MAAM;IAAW;AAC5B","debugId":null}},
    {"offset": {"line": 649, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/CMPRO128GB/AGI_projects/maiChuong_github/cmpro-gaomotion/services/motion/export.ts"],"sourcesContent":["import { MotionData } from '@/hooks/useMotionCapture';\nimport { CaptureType } from '@/components/MotionSelector';\nimport { createMotionDataPacket } from '@/lib/json-export';\n\n/**\n * Manages the WebSocket connection to a Blender tunnel for real-time data streaming.\n */\nexport class MotionTunnel {\n  private ws: WebSocket | null = null;\n\n  // Callbacks to update the UI based on connection status.\n  public onOpen: () => void = () => {};\n  public onClose: () => void = () => {};\n  public onError: (message: string) => void = () => {};\n\n  /**\n   * Establishes a connection to the WebSocket server at the given URL.\n   * @param url The wss:// or ws:// URL of the tunnel.\n   */\n  public connect(url: string): void {\n    if (this.ws && this.ws.readyState !== WebSocket.CLOSED) {\n      console.warn('A connection is already open. Disconnect first.');\n      return;\n    }\n\n    try {\n      this.ws = new WebSocket(url);\n\n      this.ws.onopen = () => {\n        console.log('Tunnel connection established.');\n        this.onOpen();\n      };\n\n      this.ws.onclose = () => {\n        console.log('Tunnel connection closed.');\n        this.onClose();\n        this.ws = null;\n      };\n\n      this.ws.onerror = (event) => {\n        console.error('Tunnel WebSocket error:', event);\n        this.onError('Connection failed. Check the URL and Blender addon.');\n        this.ws = null;\n      };\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Invalid URL.';\n      this.onError(message);\n    }\n  }\n\n  /**\n   * Closes the active WebSocket connection.\n   */\n  public disconnect(): void {\n    this.ws?.close();\n  }\n\n  /**\n   * Sends motion data through the open WebSocket connection.\n   */\n  public sendData(motionData: MotionData, captureType: CaptureType): void {\n    if (this.ws?.readyState === WebSocket.OPEN) {\n      const payload = createMotionDataPacket(motionData, captureType);\n      this.ws.send(JSON.stringify(payload));\n    }\n  }\n}"],"names":[],"mappings":";;;;AAEA;;;AAKO,MAAM;IAQX;;;GAGC,GACD,AAAO,QAAQ,GAAW,EAAQ;QAChC,IAAI,IAAI,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,CAAC,UAAU,KAAK,UAAU,MAAM,EAAE;YACtD,QAAQ,IAAI,CAAC;YACb;QACF;QAEA,IAAI;YACF,IAAI,CAAC,EAAE,GAAG,IAAI,UAAU;YAExB,IAAI,CAAC,EAAE,CAAC,MAAM,GAAG;gBACf,QAAQ,GAAG,CAAC;gBACZ,IAAI,CAAC,MAAM;YACb;YAEA,IAAI,CAAC,EAAE,CAAC,OAAO,GAAG;gBAChB,QAAQ,GAAG,CAAC;gBACZ,IAAI,CAAC,OAAO;gBACZ,IAAI,CAAC,EAAE,GAAG;YACZ;YAEA,IAAI,CAAC,EAAE,CAAC,OAAO,GAAG,CAAC;gBACjB,QAAQ,KAAK,CAAC,2BAA2B;gBACzC,IAAI,CAAC,OAAO,CAAC;gBACb,IAAI,CAAC,EAAE,GAAG;YACZ;QACF,EAAE,OAAO,OAAO;YACd,MAAM,UAAU,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YACzD,IAAI,CAAC,OAAO,CAAC;QACf;IACF;IAEA;;GAEC,GACD,AAAO,aAAmB;YACxB;SAAA,WAAA,IAAI,CAAC,EAAE,cAAP,+BAAA,SAAS,KAAK;IAChB;IAEA;;GAEC,GACD,AAAO,SAAS,UAAsB,EAAE,WAAwB,EAAQ;YAClE;QAAJ,IAAI,EAAA,WAAA,IAAI,CAAC,EAAE,cAAP,+BAAA,SAAS,UAAU,MAAK,UAAU,IAAI,EAAE;YAC1C,MAAM,UAAU,CAAA,GAAA,wHAAA,CAAA,yBAAsB,AAAD,EAAE,YAAY;YACnD,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,SAAS,CAAC;QAC9B;IACF;;QAzDA,+KAAQ,MAAuB;QAE/B,yDAAyD;QACzD,+KAAO,UAAqB,KAAO;QACnC,+KAAO,WAAsB,KAAO;QACpC,+KAAO,WAAqC,KAAO;;AAqDrD","debugId":null}},
    {"offset": {"line": 718, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/CMPRO128GB/AGI_projects/maiChuong_github/cmpro-gaomotion/components/CharacterModel.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useRef } from 'react';\nimport { useGLTF } from '@react-three/drei';\nimport { useFrame } from '@react-three/fiber';\nimport * as THREE from 'three';\nimport { RigPose } from '@/types/rig';\n\ninterface CharacterModelProps {\n  pose: RigPose | null;\n  onTposeReady: (tPose: RigPose) => void;\n  debugMode?: boolean;\n}\n\nexport const CharacterModel: React.FC<CharacterModelProps> = ({ pose, onTposeReady, debugMode = false }) => {\n  // Load the GLB model from the public directory\n  const { scene } = useGLTF('/models/metarig.glb');\n  const tPoseCaptured = useRef(false);\n  const boneAxesHelpers = useRef<Record<string, THREE.AxesHelper>>({});\n\n  // Capture the initial T-Pose of the model once it's loaded.\n  useEffect(() => {\n    if (scene && !tPoseCaptured.current) {\n      const tPose: RigPose = {};\n      scene.traverse((object) => {\n        if (object instanceof THREE.Bone) {\n          // Store the initial rotation of each bone\n          tPose[object.name] = {\n            rotation: object.quaternion.toArray() as [number, number, number, number],\n          };\n        }\n      });\n      onTposeReady(tPose);\n      tPoseCaptured.current = true;\n    }\n  }, [scene, onTposeReady]);\n  \n  // On every frame, apply the pose data to the bones\n  useFrame(() => {\n    if (pose) {\n      // Traverse the scene to find all bones\n      scene.traverse((object) => {\n        if (object instanceof THREE.Bone) {\n          // Check if the current bone has a corresponding entry in the pose data\n          const bonePose = pose[object.name];\n          if (bonePose) {\n            const { rotation } = bonePose;\n            // Apply the rotation.\n            object.quaternion.fromArray(rotation);\n\n            // Add or remove debug axes\n            if (debugMode) {\n              if (!boneAxesHelpers.current[object.name]) {\n                const helper = new THREE.AxesHelper(0.2); // 20cm axes\n                boneAxesHelpers.current[object.name] = helper;\n                object.add(helper);\n              }\n            } else if (boneAxesHelpers.current[object.name]) {\n              object.remove(boneAxesHelpers.current[object.name]);\n              delete boneAxesHelpers.current[object.name];\n            }\n          }\n        }\n      });\n    }\n  });\n\n  // The primitive object is a way to render a pre-existing Three.js object\n  return <primitive object={scene} />;\n};\n\n// Preload the model so it's ready when the component mounts for a better user experience.\nuseGLTF.preload('/models/metarig.glb');"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAcO,MAAM,iBAAgD;QAAC,EAAE,IAAI,EAAE,YAAY,EAAE,YAAY,KAAK,EAAE;;IACrG,+CAA+C;IAC/C,MAAM,EAAE,KAAK,EAAE,GAAG,CAAA,GAAA,2JAAA,CAAA,UAAO,AAAD,EAAE;IAC1B,MAAM,gBAAgB,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAE;IAC7B,MAAM,kBAAkB,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAoC,CAAC;IAElE,4DAA4D;IAC5D,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;oCAAE;YACR,IAAI,SAAS,CAAC,cAAc,OAAO,EAAE;gBACnC,MAAM,QAAiB,CAAC;gBACxB,MAAM,QAAQ;gDAAC,CAAC;wBACd,IAAI,kBAAkB,kJAAA,CAAA,OAAU,EAAE;4BAChC,0CAA0C;4BAC1C,KAAK,CAAC,OAAO,IAAI,CAAC,GAAG;gCACnB,UAAU,OAAO,UAAU,CAAC,OAAO;4BACrC;wBACF;oBACF;;gBACA,aAAa;gBACb,cAAc,OAAO,GAAG;YAC1B;QACF;mCAAG;QAAC;QAAO;KAAa;IAExB,mDAAmD;IACnD,CAAA,GAAA,kNAAA,CAAA,WAAQ,AAAD;mCAAE;YACP,IAAI,MAAM;gBACR,uCAAuC;gBACvC,MAAM,QAAQ;+CAAC,CAAC;wBACd,IAAI,kBAAkB,kJAAA,CAAA,OAAU,EAAE;4BAChC,uEAAuE;4BACvE,MAAM,WAAW,IAAI,CAAC,OAAO,IAAI,CAAC;4BAClC,IAAI,UAAU;gCACZ,MAAM,EAAE,QAAQ,EAAE,GAAG;gCACrB,sBAAsB;gCACtB,OAAO,UAAU,CAAC,SAAS,CAAC;gCAE5B,2BAA2B;gCAC3B,IAAI,WAAW;oCACb,IAAI,CAAC,gBAAgB,OAAO,CAAC,OAAO,IAAI,CAAC,EAAE;wCACzC,MAAM,SAAS,IAAI,kJAAA,CAAA,aAAgB,CAAC,MAAM,YAAY;wCACtD,gBAAgB,OAAO,CAAC,OAAO,IAAI,CAAC,GAAG;wCACvC,OAAO,GAAG,CAAC;oCACb;gCACF,OAAO,IAAI,gBAAgB,OAAO,CAAC,OAAO,IAAI,CAAC,EAAE;oCAC/C,OAAO,MAAM,CAAC,gBAAgB,OAAO,CAAC,OAAO,IAAI,CAAC;oCAClD,OAAO,gBAAgB,OAAO,CAAC,OAAO,IAAI,CAAC;gCAC7C;4BACF;wBACF;oBACF;;YACF;QACF;;IAEA,yEAAyE;IACzE,qBAAO,6LAAC;QAAU,QAAQ;;;;;;AAC5B;GAvDa;;QAEO,2JAAA,CAAA,UAAO;QAsBzB,kNAAA,CAAA,WAAQ;;;KAxBG;AAyDb,0FAA0F;AAC1F,2JAAA,CAAA,UAAO,CAAC,OAAO,CAAC","debugId":null}},
    {"offset": {"line": 824, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/CMPRO128GB/AGI_projects/maiChuong_github/cmpro-gaomotion/components/CharacterViewer.tsx"],"sourcesContent":["'use client';\n\nimport React, { Suspense } from 'react';\nimport { Canvas } from '@react-three/fiber';\nimport { OrbitControls } from '@react-three/drei';\nimport { CharacterModel } from './CharacterModel';\nimport { RigPose } from '@/types/rig';\n\n/**\n * A 3D viewer component to display the character model and its animated pose.\n * This component uses react-three-fiber to render a Three.js scene.\n */\nconst CharacterViewer: React.FC<{\n  pose: RigPose | null;\n  onTposeReady: (tPose: RigPose) => void;\n  debugMode?: boolean;\n}> = ({ pose, onTposeReady, debugMode = false }) => {\n  return (\n    <div className=\"w-full h-full bg-neutral-200 dark:bg-neutral-800 rounded-lg\">\n      <Canvas camera={{ position: [0, 1, 2.5], fov: 50 }}>\n        <ambientLight intensity={0.5} />\n        <directionalLight position={[5, 5, 5]} intensity={1} />\n        <OrbitControls />\n        {debugMode && <axesHelper args={[1]} />} {/* World axes */}\n        <Suspense fallback={null}>\n          <CharacterModel pose={pose} onTposeReady={onTposeReady} debugMode={debugMode} />\n        </Suspense>\n      </Canvas>\n    </div>\n  );\n};\n\nexport default CharacterViewer;"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAQA;;;CAGC,GACD,MAAM,kBAID;QAAC,EAAE,IAAI,EAAE,YAAY,EAAE,YAAY,KAAK,EAAE;IAC7C,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC,sMAAA,CAAA,SAAM;YAAC,QAAQ;gBAAE,UAAU;oBAAC;oBAAG;oBAAG;iBAAI;gBAAE,KAAK;YAAG;;8BAC/C,6LAAC;oBAAa,WAAW;;;;;;8BACzB,6LAAC;oBAAiB,UAAU;wBAAC;wBAAG;wBAAG;qBAAE;oBAAE,WAAW;;;;;;8BAClD,6LAAC,oKAAA,CAAA,gBAAa;;;;;gBACb,2BAAa,6LAAC;oBAAW,MAAM;wBAAC;qBAAE;;;;;;gBAAK;8BACxC,6LAAC,6JAAA,CAAA,WAAQ;oBAAC,UAAU;8BAClB,cAAA,6LAAC,gIAAA,CAAA,iBAAc;wBAAC,MAAM;wBAAM,cAAc;wBAAc,WAAW;;;;;;;;;;;;;;;;;;;;;;AAK7E;KAlBM;uCAoBS","debugId":null}},
    {"offset": {"line": 930, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/CMPRO128GB/AGI_projects/maiChuong_github/cmpro-gaomotion/app/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport MotionSelector, { CaptureType } from '@/components/MotionSelector';\nimport TunnelPairer, { TunnelStatus } from '@/components/TunnelPairer';\nimport { useMotionCapture, MotionData } from '@/hooks/useMotionCapture';\nimport { downloadMotionDataAsJson } from '@/lib/json-export';\nimport RigMapper from '@/components/RigMapper';\nimport { mapMotionDataToRigPose } from '@/services/motion/mapper';\nimport { MotionTunnel } from '@/services/motion/export';\nimport CharacterViewer from '@/components/CharacterViewer';\nimport { RigPose } from '@/types/rig';\nimport InputSelector, { InputSourceType } from '@/components/InputSelector';\n\n/**\n * A dedicated component for the live capture view.\n * This ensures that the useMotionCapture hook is not called conditionally.\n */\nconst CaptureView = ({\n  captureType,\n  onBack,\n}: {\n  captureType: CaptureType;\n  onBack: () => void;\n}) => {\n  const motionTunnelRef = useRef<MotionTunnel | null>(null);\n\n  // Use a ref to store the latest motion data to avoid re-renders on every frame.\n  const motionDataRef = useRef<MotionData | null>(null);\n  // Use state to track if any data has been captured at all, to enable/disable export buttons.\n  const [hasCapturedData, setHasCapturedData] = useState(false);\n  const [visualizedPose, setVisualizedPose] = useState<RigPose | null>(null);\n  const [tPose, setTpose] = useState<RigPose | null>(null);\n  const [debugMode, setDebugMode] = useState(false);\n  const [inputSource, setInputSource] = useState<InputSourceType>('webcam');\n  const [videoUrl, setVideoUrl] = useState<string | undefined>();\n\n  const {\n    videoRef,\n    canvasRef,\n    isCameraOn,\n    isProcessing,\n    error,\n    startCapture,\n    stopCapture,\n  } = useMotionCapture({\n    inputSource,\n    videoUrl,\n    captureType,\n    onData: (data) => {\n      // 1. Map the raw data to a rig pose\n      const rigPose = mapMotionDataToRigPose(data, tPose);\n      if (!rigPose) return;\n\n      motionDataRef.current = rigPose; // Store the mapped pose for export/tunnel\n      setVisualizedPose(rigPose); // Update state for visualization\n      if (!hasCapturedData) setHasCapturedData(true);\n      motionTunnelRef.current?.sendData(rigPose, captureType); // Send the mapped pose\n    },\n  });\n\n  const [tunnelStatus, setTunnelStatus] = useState<TunnelStatus>('disconnected');\n  const [tunnelError, setTunnelError] = useState<string | null>(null);\n\n  const handleConnect = (url: string) => {\n    if (!motionTunnelRef.current) {\n      motionTunnelRef.current = new MotionTunnel();\n    }\n\n    setTunnelStatus('connecting');\n    setTunnelError(null);\n\n    motionTunnelRef.current.onOpen = () => setTunnelStatus('connected');\n    motionTunnelRef.current.onClose = () => setTunnelStatus('disconnected');\n    motionTunnelRef.current.onError = (message) => {\n      setTunnelStatus('error');\n      setTunnelError(message);\n    };\n\n    motionTunnelRef.current.connect(url);\n  };\n\n  const handleDisconnect = () => {\n    motionTunnelRef.current?.disconnect();\n  };\n\n  // Effect to ensure the tunnel is disconnected on component unmount.\n  useEffect(() => {\n    return () => {\n      motionTunnelRef.current?.disconnect();\n    };\n  }, []);\n\n  const handleSourceChange = (sourceType: InputSourceType, url?: string) => {\n    stopCapture();\n    setInputSource(sourceType);\n    setVideoUrl(url);\n  };\n\n  return (\n    <div className=\"w-full max-w-4xl flex flex-col items-center\">\n      <div className=\"w-full flex justify-between items-center mb-4\">\n        <button\n          onClick={onBack}\n          className=\"px-4 py-2 border rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800/30 transition-colors\"\n        >\n          &larr; Back\n        </button>\n        <h1 className=\"text-2xl font-bold capitalize\">{captureType} Capture</h1>\n        <div className=\"w-24\" /> {/* Spacer */}\n      </div>\n\n      <div className=\"w-full mb-4\">\n        <InputSelector\n          currentSource={inputSource}\n          onSourceSelect={(source) => handleSourceChange(source)}\n        />\n      </div>\n\n      <div className=\"grid w-full grid-cols-1 md:grid-cols-2 gap-4 aspect-video\">\n        {/* 2D Video Feed */}\n        <div className=\"relative w-full h-full bg-black rounded-lg overflow-hidden shadow-lg\">\n          <video ref={videoRef} className=\"w-full h-full\" autoPlay playsInline />\n          <canvas\n            ref={canvasRef}\n            className=\"absolute top-0 left-0 w-full h-full\"\n          />\n        </div>\n        {/* 3D Character Viewer */}\n        <CharacterViewer pose={visualizedPose} onTposeReady={setTpose} debugMode={debugMode} />\n      </div>\n\n      <div className=\"flex flex-wrap items-center justify-center gap-4 mt-4\">\n        <button\n          onClick={startCapture}\n          disabled={isCameraOn || isProcessing}\n          className=\"px-4 py-2 bg-blue-600 text-white rounded-lg disabled:bg-gray-400 transition-colors\"\n        >\n          {isProcessing ? 'Initializing...' : 'Start Capture'}\n        </button>\n        <button\n          onClick={stopCapture}\n          disabled={!isCameraOn}\n          className=\"px-4 py-2 bg-red-600 text-white rounded-lg disabled:bg-gray-400 transition-colors\"\n        >\n          Stop Capture\n        </button>\n        <button\n          onClick={() => {\n            if (motionDataRef.current) {\n              downloadMotionDataAsJson(motionDataRef.current, captureType);\n            }\n          }}\n          disabled={!hasCapturedData}\n          className=\"px-4 py-2 bg-green-600 text-white rounded-lg disabled:bg-gray-400 transition-colors\"\n          title=\"Download the last captured frame as a JSON file.\"\n        >\n          Export JSON\n        </button>\n        <label className=\"flex items-center space-x-2 cursor-pointer p-2 rounded-lg bg-neutral-100 dark:bg-neutral-800\">\n          <input\n            type=\"checkbox\"\n            checked={debugMode}\n            onChange={(e) => setDebugMode(e.target.checked)}\n            className=\"form-checkbox\"\n          />\n          <span className=\"text-sm\">Debug Mode</span>\n        </label>\n      </div>\n      {error && <p className=\"mt-4 text-red-500\">{error}</p>}\n\n      <div className=\"mt-8 grid w-full grid-cols-1 gap-8 md:grid-cols-2\">\n        <TunnelPairer\n          status={tunnelStatus}\n          error={tunnelError}\n          onConnect={handleConnect}\n          onDisconnect={handleDisconnect}\n        />\n        <RigMapper pose={visualizedPose} />\n      </div>\n    </div>\n  );\n};\n\nexport default function Home() {\n  const [captureType, setCaptureType] = useState<CaptureType | null>(null);\n\n  return (\n    <main className=\"flex min-h-screen flex-col items-center justify-center p-4 md:p-8\">\n      {!captureType ? (\n        <MotionSelector onSelect={setCaptureType} />\n      ) : (\n        <CaptureView captureType={captureType} onBack={() => setCaptureType(null)} />\n      )}\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}